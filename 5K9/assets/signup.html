<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Roboto:ital,wght@0,500;0,700;1,500;1,700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles/styles.css" />
    <title>5K9 Running</title>
  </head>

  <body>
    <div id="l-boundary">
      <!-- Header -->
      <header id="l-header">
        <!-- Navbar -->
        <nav class="l-container navbar">
          <div class="navgroup navbar-brand">
            <a href="/">
              <h2>5K9 Running</h2>
            </a>
          </div>
          <div class="navgroup">
            <a class="navgroup-link" href="/about.html">About</a>
            <a class="navgroup-link" href="/about.html">Store</a>
            <a class="navgroup-link" href="/about.html">Events</a>
            <a class="navgroup-link" href="/resources.html">Resources</a>
          </div>
          <div class="navgroup navbar-acct">
            <a class="navgroup-link" href="/about.html">Sign in</a>
            <button>
              <a class="navgroup-link" href="/signup.html">Sign up</a>
            </button>
          </div>
        </nav>
      </header>
      <!-- Main -->
      <main id="l-main">
        <div class="l-container">
          <section class="main-intro">
            <h2>Join 5K9 Running</h2>
            <p>
              When you sign up for 5K9 Running, you can receive free resources
              to help you start running today.
            </p>
          </section>
          <section id="error-banner" hidden>
            <p class="error-text"></p>
          </section>
          <section class="main-content">
            <div>
              <form
                action="/send-signup-email"
                method="POST"
                class="page-form"
                id="signup-form"
              >
                <fieldset>
                  <legend>You</legend>
                  <div>
                    <label for="firstName">First name*</label>
                    <br />
                    <input
                      type="text"
                      inputmode="text"
                      name="firstName"
                      id="firstName"
                      required
                    />
                    <br />
                    <label for="lastName">Last name*</label>
                    <br />
                    <input
                      type="text"
                      inputmode="text"
                      name="lastName"
                      id="lastName"
                      required
                    />
                    <br />
                    <label for="email">Email address*</label>
                    <br />
                    <input
                      type="email"
                      inputmode="email"
                      name="email"
                      id="email"
                      required
                    />
                  </div>
                </fieldset>
                <fieldset>
                  <legend>Your dog</legend>
                  <div>
                    <label for="dogName">Dog's name*</label>
                    <br />
                    <input
                      type="text"
                      inputmode="text"
                      name="dogName"
                      id="dogName"
                      autocomplete="off"
                      required
                    />
                    <br />
                    <label for="dogFavoriteTreat">Dog's favorite treat</label>
                    <br />
                    <input
                      type="text"
                      inputmode="text"
                      name="dogFavoriteTreat"
                      id="dogFavoriteTreat"
                      autocomplete="off"
                    />
                    <input
                      type="checkbox"
                      inputmode="text"
                      name="dogAge"
                      id="dogAge"
                    />
                    <label for="dogAge">
                      Is your dog at least 1.5 years old?
                    </label>
                  </div>
                </fieldset>
                <fieldset>
                  <legend>Free resources</legend>
                  <div>
                    <input
                      type="checkbox"
                      inputmode="text"
                      name="resources"
                      id="nightChecklist"
                      value="Night Running Checklist"
                    />
                    <label for="nightChecklist">
                      Night Running Checklist
                    </label>
                    <br />
                    <input
                      type="checkbox"
                      inputmode="text"
                      name="resources"
                      id="harnessPicks"
                      value="2022 Harness Picks"
                    />
                    <label for="harnessPicks">2022 Harness Picks</label>
                  </div>
                </fieldset>
                <div>
                  <button type="submit" id="submit">
                    Submit
                    <div
                      id="loader-animation"
                      class="loader-animation spin"
                      hidden
                    >
                      <?xml version="1.0" encoding="UTF-8"?><svg
                        id="a"
                        xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink"
                        viewBox="0 0 15 14.99"
                      >
                        <defs>
                          <style>
                            .c {
                              fill: url(#b);
                            }
                          </style>
                          <linearGradient
                            id="b"
                            x1="0"
                            y1="7.49"
                            x2="15"
                            y2="7.49"
                            gradientTransform="matrix(1, 0, 0, 1, 0, 0)"
                            gradientUnits="userSpaceOnUse"
                          >
                            <stop
                              offset="0"
                              stop-color="#fff"
                              stop-opacity="0"
                            />
                            <stop
                              offset=".15"
                              stop-color="#909090"
                              stop-opacity=".43"
                            />
                            <stop offset="1" stop-color="#000" />
                          </linearGradient>
                        </defs>
                        <path
                          class="c"
                          d="M7.02,14.98c-.26,0-.46-.23-.44-.5h0c0-.25,.24-.45,.5-.43h0c.25,0,.45,.23,.44,.5h0c-.02,.24-.23,.44-.47,.44h0s-.02,0-.03-.01Zm1.2-.47c-.05-.26,.12-.5,.38-.54h0c.26-.05,.51,.12,.55,.38h0c.05,.25-.12,.5-.39,.53h0s-.05,0-.07,0h0c-.23,0-.42-.16-.46-.38Zm-2.93,.17c-.24-.08-.39-.34-.31-.59h0c.08-.24,.34-.38,.58-.31h0c.25,.08,.39,.34,.32,.58h0c-.07,.21-.25,.34-.45,.34h0s-.09,0-.14-.02Zm4.53-.53c-.1-.23,0-.52,.25-.61h0c.24-.1,.51,0,.61,.24h0c.1,.23-.01,.52-.25,.62h0c-.06,.02-.12,.03-.19,.03h0c-.18,0-.36-.1-.43-.28Zm-6.13-.17h0c-.23-.13-.3-.42-.17-.64h0c.13-.22,.41-.3,.64-.17h0c.23,.13,.3,.41,.17,.64h0c-.08,.15-.24,.23-.4,.23h0c-.08,0-.16-.03-.24-.07Zm7.61-.55c-.15-.21-.1-.5,.1-.66h0c.21-.15,.5-.1,.66,.1h0c.15,.21,.1,.5-.1,.66h0c-.08,.06-.19,.08-.28,.08h0c-.15,0-.29-.06-.39-.19Zm-9.01-.5c-.19-.18-.2-.48-.02-.67h0c.18-.19,.48-.19,.67-.02h0c.19,.19,.2,.48,.02,.67h0c-.09,.1-.22,.15-.35,.15h0c-.11,0-.23-.05-.32-.13Zm10.29-.54c-.21-.17-.23-.46-.07-.66h0c.17-.2,.47-.23,.67-.06h0c.2,.17,.23,.46,.06,.66h0c-.09,.11-.23,.17-.36,.17h0c-.11,0-.22-.04-.3-.11Zm-11.41-.8c-.14-.22-.08-.51,.14-.65h0c.22-.15,.51-.08,.65,.13h0c.14,.22,.08,.51-.14,.65h0c-.08,.06-.17,.08-.25,.08h0c-.15,0-.3-.08-.39-.21Zm12.39-.51c-.23-.12-.32-.4-.21-.63h0c.12-.23,.4-.33,.63-.21h0c.24,.11,.33,.39,.22,.63h0c-.08,.16-.25,.25-.42,.25h0c-.08,0-.14-.01-.22-.05ZM.39,10.02c-.08-.24,.05-.52,.29-.6H.68c.24-.08,.51,.04,.6,.28h0c.08,.24-.05,.52-.29,.6H.99s-.1,.03-.16,.03H.83c-.19,0-.37-.12-.44-.31Zm13.84-.44c-.25-.06-.4-.31-.35-.56h0c.06-.25,.31-.41,.56-.35h0c.25,.06,.41,.31,.36,.56h0c-.05,.22-.25,.36-.45,.36h0s-.08,0-.11,0ZM0,8.31c-.03-.25,.16-.49,.41-.52H.42c.25-.03,.49,.16,.52,.42H.93c.03,.25-.16,.49-.41,.52h-.06c-.24,0-.44-.18-.46-.42Zm14.06-.82h0c0-.26,.21-.47,.47-.47h0c.25,0,.47,.21,.47,.47h0c0,.26-.22,.47-.47,.47h0c-.26,0-.47-.21-.47-.47ZM.42,7.09c-.25-.03-.43-.26-.4-.53H.01c.03-.25,.26-.44,.53-.4H.54c.25,.03,.44,.26,.4,.52H.94c-.03,.24-.23,.41-.46,.41h-.07Zm13.48-1.02c-.06-.25,.1-.51,.36-.56h0c.25-.06,.51,.1,.56,.36h0c.06,.25-.1,.51-.36,.56h0s-.07,0-.1,0h0c-.22,0-.4-.15-.46-.37ZM.71,5.48c-.24-.09-.37-.37-.28-.61H.43c.09-.24,.37-.37,.61-.27h0c.24,.08,.37,.36,.27,.6h0c-.08,.19-.25,.31-.44,.31H.87c-.06,0-.11,0-.16-.03Zm12.69-.85c-.11-.23-.02-.52,.22-.63h0c.24-.11,.52-.02,.63,.22h0c.11,.23,0,.52-.22,.63h0c-.07,.04-.14,.05-.21,.05h0c-.18,0-.35-.09-.42-.26ZM1.36,3.97c-.22-.14-.27-.43-.13-.65h0c.15-.22,.44-.27,.66-.13h0c.22,.14,.27,.43,.12,.65h0c-.08,.14-.24,.21-.39,.21h0c-.09,0-.18-.02-.26-.08Zm11.22-.63h0c-.17-.2-.14-.5,.07-.66h0c.2-.17,.5-.14,.66,.07h0c.17,.2,.14,.5-.07,.66h0c-.08,.08-.19,.1-.29,.1h0c-.14,0-.27-.06-.37-.17ZM2.34,2.65c-.18-.2-.17-.49,.02-.67h0c.2-.18,.49-.16,.67,.03h0c.18,.19,.17,.49-.03,.66h0c-.08,.08-.21,.13-.32,.13h0c-.12,0-.25-.06-.34-.15Zm9.13-.38h0c-.21-.16-.24-.46-.09-.66h0c.16-.21,.46-.25,.66-.09h0c.21,.16,.25,.45,.09,.66h0c-.09,.12-.24,.19-.38,.19h0c-.1,0-.2-.03-.28-.09ZM3.6,1.6c-.13-.23-.05-.51,.17-.64h0c.24-.12,.52-.05,.65,.18h0c.12,.23,.05,.52-.18,.64h0c-.08,.05-.15,.07-.24,.07h0c-.16,0-.32-.08-.4-.24Zm6.55-.1c-.24-.1-.35-.38-.24-.62h0c.11-.23,.39-.34,.62-.23h0c.24,.1,.35,.38,.24,.62h0c-.08,.18-.25,.28-.43,.28h0c-.07,0-.13-.02-.19-.05ZM5.07,.86c-.08-.24,.08-.51,.32-.58h0c.25-.08,.51,.07,.58,.32h0c.08,.25-.08,.52-.32,.58h0s-.08,.02-.13,.02h0c-.21,0-.39-.13-.45-.34Zm3.62,.18h0c-.25-.05-.42-.29-.38-.54h0c.05-.26,.29-.43,.55-.38h0c.25,.05,.42,.29,.38,.54h0c-.05,.23-.24,.38-.47,.38h0s-.06,0-.08,0ZM6.67,.49c0-.25,.19-.48,.45-.49h0c.26,0,.48,.19,.49,.45h0c.02,.25-.19,.47-.44,.49h-.03c-.24,0-.45-.2-.47-.45Z"
                        />
                      </svg>
                    </div>
                  </button>
                </div>
              </form>
            </div>
          </section>
        </div>
      </main>
      <!-- Footer -->
      <footer id="l-footer">
        <div class="l-container footer-content">
          <p>
            Built by
            <a
              href="https://www.twilio.com/company/values"
              target="_blank"
              rel="noopener norefferer"
              >Pawsitrons</a
            >
            | Copyright &copy; <span id="copyright-date"></span>
            <a
              href="https://twilio.com"
              target="_blank"
              rel="noopener noreferrer"
              >Twilio Inc.</a
            >
          </p>
        </div>
      </footer>
    </div>
  </body>
</html>
<!-- Scripts -->
<!-- Display error message on submission failure -->
<script>
  const form = document.getElementById("signup-form");
  const errorBanner = document.getElementById("error-banner");
  const firstNameInput = document.getElementById("firstName");
  const lastNameInput = document.getElementById("lastName");
  const emailInput = document.getElementById("email");
  const dogNameInput = document.getElementById("dogName");
  const dogAgeInput = document.getElementById("dogAge");
  const dogFavoriteTreatInput = document.getElementById("dogFavoriteTreat");
  const nightChecklistInput = document.getElementById("nightChecklist");
  const harnessPicksInput = document.getElementById("harnessPicks");
  const submitButton = document.getElementById("submit");
  const loaderAnimation = document.getElementById("loader-animation");

  function setErrorBanner(errorMessage) {
    errorBanner.textContent = errorMessage;
    errorBanner.removeAttribute("hidden");
    errorBanner.classList.add("error-banner");
  }

  function setLoaderAnimation() {
    loaderAnimation.removeAttribute("hidden");
  }

  function unsetLoaderAnimation() {
    loaderAnimation.setAttribute("hidden", true);
  }

  /*
   * Check an array of checkbox items
   * return the checkbox value
   */
  function getResources(checkboxInputs) {
    return checkboxInputs.reduce((result, currentCheckBox) => {
      if (currentCheckBox.checked) {
        result.push(currentCheckBox.value);
      }
      return result;
    }, []);
  }

  form.addEventListener("submit", async (event) => {
    event.preventDefault();
    submitButton.setAttribute("disabled", "disabled");

    let selectedResources = getResources([
      nightChecklistInput,
      harnessPicksInput,
    ]);

    // Fetch form field data
    try {
      setLoaderAnimation();
      const response = await fetch(form.getAttribute("action"), {
        method: form.getAttribute("method"),
        body: JSON.stringify({
          firstName: firstNameInput.value,
          lastName: lastNameInput.value,
          email: emailInput.value,
          dogName: dogNameInput.value,
          dogFavoriteTreat: dogFavoriteTreatInput.value,
          dogAge: dogAgeInput.checked ? dogAgeInput.value : "",
          resources: selectedResources,
        }),
        headers: {
          "Content-Type": "application/json",
        },
      });
      if (response.ok) {
        const { redirect_path } = await response.json();
        window.location = redirect_path;
      } else {
        unsetLoaderAnimation();
        const data = await response.json();
        setErrorBanner(data.error);
      }
    } catch (error) {
      unsetLoaderAnimation();
      setErrorBanner("We encountered an error and could not process the form.");
    } finally {
      submitButton.removeAttribute("disabled");
    }
  });
</script>
<!-- Copyright year -->
<script>
  const fullYear = new Date().getFullYear();
  copyrightDate = document.getElementById("copyright-date").innerHTML =
    fullYear;
</script>
